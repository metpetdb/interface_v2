{% extends "base.html" %}

{% block title %}
<h4>
  Sample {{ sample.number }}
  <div style="height:0px;overflow:hidden">
   <input type="file" id="fileInput" name="fileInput" />
  </div>
  {% if sample.public_data %}<a id="imgUpload" style="float:right" onclick="chooseFile();" href="#">Add Image</a>{% endif %}
  <div style='float:right'> &nbsp; &nbsp; &nbsp; </div>


  {% if auth_token %}<span style="float:right"><a href="{{ url_for('edit_sample', id=sample.id) }}">Edit Sample</a></span>{% endif %}

</h4>
{% endblock %}

{% block body %}
<div class="table-responsive">
  <table id="sampleview_table" class="table">
    <tbody>
      <tr>
        <td class="sample_label">Owner</td>
        <td class="sample_value">{% if sample.owner %}{{ sample.owner }}{% endif %}</td>
      </tr>
      <tr>
        <td class="sample_label">Date Collected</td>
        <td class="sample_value">{% if sample.collection_date %}{{ sample.collection_date }}{% endif %}</td>
      </tr>
      <tr>
        <td class="sample_label">Rock Type</td>
        <td class="sample_value">{% if sample.rock_type %}{{ sample.rock_type }}{% endif %}</td>
      </tr>
      <tr>
        <td class="sample_label">Latitude</td>
        <td class="sample_value">{% if sample.latitude %}{{ sample.latitude }}{% endif %}</td>
      </tr>
      <tr>
        <td class="sample_label">Longitude</td>
        <td class="sample_value">{% if sample.longitude %}{{ sample.longitude }}{% endif %}</td>
      </tr>

      <tr>
        <td class="sample_label">Country</td>
        <td class="sample_value">{% if sample.country %}{{ sample.country }}{% endif %}</td>
      </tr>
      <tr>
        <td class="sample_label">Collector</td>
        <td class="sample_value">{% if sample.collector_name %}{{ sample.collector_name }}{% endif %}</td>
      </tr>
      <tr>
        <td class="sample_label">Present Location</td>
        <td class="sample_value">{% if sample.location_name %}{{ sample.location_name }}{% endif %}</td>
      </tr>
      <tr>
        <td class="sample_label">Regions</td>
        <td class="sample_value">{% if sample.regions %}{% for r in sample.regions %}{% if loop.index0 > 0 %}, {% endif %}{{ r }}{% endfor %}{% endif %}</td>
      </tr>
      <tr>
        <td class="sample_label">Metamorphic Regions</td>
        <td class="sample_value">{% if sample.metamorphic_regions %}{% for r in sample.metamorphic_regions %}{% if loop.index0 > 0 %}, {% endif %}{{ r }}{% endfor %}{% endif %}</td>
      </tr>
      <tr>
        <td class="sample_label">Metamorphic Grades</td>
        <td class="sample_value">{% if sample.metamorphic_grades %}{% for g in sample.metamorphic_grades %}{% if loop.index0 > 0 %}, {% endif %}{{ g }}{% endfor %}{% endif %}</td>
      </tr>
      <tr>
        <td class="sample_label">Publication References</td> <!--  New Format  -->
        <td class="sample_value">
        {% if sample.references %}{% for r in sample.references %}
          {{ r }} 
        {% endfor %}{% endif %}
        </td>
      </tr>
      <tr>
        <td class="sample_label">Description</td>
        <td class="sample_value">{% if sample.description %}{{ sample.description }}{% endif %}</td>
      </tr>
      <tr>
        <td class="sample_label">Minerals</td>
        <td class="sample_value">{% if sample.minerals %}{% for m in sample.minerals %}{% if loop.index0 > 0 %}, {% endif %}{{ m }}{% endfor %}{% endif %}</td>
      </tr>
    </tbody>
  </table>
  <div id="map_canvas"></div>

</div>


<hr>
<div class="container">
  <h4>Sample Images</h4>
    <div class = "row">
      <script>
        var currentImage = 0;
        var images = {};
      </script>
      {% if sample.images %} {%for image in sample.images %}
      <script>
        images[{{ loop.index }}] = {"url":"{{ image.image.full_size }}", "description": "{{ image.image_type.comments }}",
        "type": "{{ image.image_type.image_type }}" };
      </script>
      <div class="col-sm-2" style="width:20%; ; height:250px; max-height:250px">
        <div class="thumbnail" id="{{ loop.index }}">
          <img src = "{{ image.image.full_size }}" style="width:100%; height:200px" class="sampleimg"
               onclick="overlay_on({{loop.index}})">
          <div class="caption" id="caption">
            {{ image.image_type.image_type }}
          </div>
        </div>
      </div>
      {% endfor %}
      {% endif %}

</div>


<style>
.modal {
  position: fixed; /* Sit on top of the page content */
  display: none; /* Hidden by default */
  width: 100%; /* Full width (cover the whole page) */
  height: 100%; /* Full height (cover the whole page) */
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: rgba(0,0,0,0.5); /* Black background with opacity */
  z-index: 2; /* Specify a stack order in case you're using a different order for other elements */
  cursor: pointer; /* Add a pointer on hover */
}

.disp-img{
text-align: center;
border-style: solid;
border-width: thin;
background-color: #e4e6e5;
width: 100%;
height: 100%;
max-height: 100%;
}

.disp-img img
{
  width: auto;
  height: 100%;
  max-height: 100%;
  max-width: 100%;
  object-fit: contain;
}

.img-panel{
position: fixed;
text-align: center;
top: 33%;
left: 50%;
margin-top: -15%;
margin-left: -38%;
width: 75%;
height: 85%;
max-height: 85%;
background-color: #FFFFFF;
}

</style>

<div class="modal" id="overlay" onclick="overlay_off()">

    <div class="img-panel">
      <div class="disp-img">
        <img src = "" id="displayImage" >
      </div>
    </div>

</div>

</div>

<hr>
<h4>Subsamples{% if auth_token %}<span style="float:right"><a href="{{ url_for('edit_subsample', id='new')}}?sample_id={{ sample.id }}">Add Subsample</a></span>{% endif %}</h4>
<div class="table-responsive">
  <table id="subsampletable_canvas">
    <thead>
      <tr>
        <th>Name</th>
        <th>Public</th>
        <th>Type</th>
        <th>Image Count</th>
        <th>Chemical Analysis Count</th>
        <th>Owner</th>
        <th>Image Map</th>
      </tr>
    </thead>
    <tbody>
      {% for subsample in subsamples %}
      <tr>
        <td id="img-popup"><a href="{{ url_for('subsample', id=subsample.id) }}">{{ subsample.name }}</a></td>
        <td>{{ subsample.public_data }}</td>
        <td>{{ subsample.subsample_type.name }}</td>
        <td>{{ subsample.images }}</td>
        <td>{{ subsample.chemical_analyses|length }}</td>
        <td><a href="{{ url_for('user', email=email) }}" target="_blank">{{ sample.owner.name }}</a></td>
        <td> -- </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<script src="/static/js/jquery-2.1.1.min.js"></script>
<script type="text/javascript" src="/static/js/jquery.dataTables.min.js"></script>
<script src="http://maps.googleapis.com/maps/api/js?key=AIzaSyCGEQBqKb2zbQdXuO8c9QNkvvkoL20eNw4"></script>

<script>

//Image overlay functions
function overlay_on(e){
  document.getElementById("overlay").style.display = "block";
  currentImage = images[e];
  document.getElementById("displayImage").src = currentImage["url"];
}

function overlay_off(){
  document.getElementById("overlay").style.display = "none";
}


//$('.thumbnail').click(overlay_on);


function chooseFile() {
      $("#fileInput").click();
}

$(document).ready(function()
{
 // $('#subsampletable_canvas').dataTable();
 //  $('#thumb_cell td a').lightbox();
});

var map_lat = {{ sample.latitude }}; 
var map_long = {{ sample.longitude }};  

var myCenter=new google.maps.LatLng(map_lat, map_long);
function initialize()
{
  var mapProp = {
    center:myCenter,
    zoom:8,
    mapTypeId:google.maps.MapTypeId.HYBRID
  };

  var map=new google.maps.Map(document.getElementById("map_canvas"), mapProp);
  var infowindow = new google.maps.InfoWindow();

  var marker=new google.maps.Marker({
    position:myCenter,
  });

  var content="latitude:"+map_lat+","+"longitude:"+map_long;

  makeInfoWindowEvent(map, infowindow, content, marker);
  marker.setMap(map);

  function makeInfoWindowEvent(map, infowindow, contentString, marker) {
    google.maps.event.addListener(marker, 'click', function() {
      infowindow.setContent(contentString);
      infowindow.open(map, marker);
    })
  };
}
google.maps.event.addDomListener(window, 'load', initialize);
</script>

{% endblock %}
